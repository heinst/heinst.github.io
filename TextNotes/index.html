<!DOCTYPE html>
<html lang="en">
    <head>
	    <!-- imports -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>TextNotes</title>
        <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <script src="js/jquery-2.1.3.min.js"></script>
        <script src="js/cloudmine-0.9.12.min.js"></script>
        <script src="js/isbn.js"></script>
        <script src="js/isbn-groups.js"></script>
        <link href="css/hover-min.css" rel="stylesheet">
        <link rel="stylesheet" href="font-awesome-4.3.0/css/font-awesome.min.css" type="text/css">
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        <!--
            .btn-default{
                background-color: transparent;
                border-color: transparent;
                padding-top: 8px;
                padding-bottom: 8px;
                color:#ffffff;
            }
            .btn-default:hover{
                background-color: transparent;
                border-color: transparent;
                color:#595959;
            }
            -->
        <script>
	        //keeps track of last div shown
	        var lastDivShown = "";
	        //smooth scorlling
            $(function() {
	            $('a[href*=#]:not([href=#])').click(function() {
		            if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) 
		            {
			            var target = $(this.hash);
			            target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
			            if (target.length) 
			            {
			            	$('html,body').animate({
			            		scrollTop: target.offset().top
			                }, 1000);
			            	return false;
			            }
		            }
	            });
            });
            
            //formulates accordian to display notes and appends it to the div
            
            function displayNotes(isbn10, isbn13)
			{
				
				var accordian ='<div class="notesaccordian" style="padding-top: 150px; padding-right: 24px;"><div class="panel-group" id="accordion"'  
								+ 'role="tablist" aria-multiselectable="true">';
								
				//makes ajax call to get book data
				
				getBookData(isbn10, isbn13).done(function(result) {
					var notes = [];	
					if(isbn13 in result.success)
					{
						var obj = result.success[isbn13];
						notes = obj.notes;
					}
					
					for (var n in notes)
					{
						accordian = accordian + '<div class="panel panel-default">';
						accordian = accordian + '<div class="panel-heading" role="tab" id="heading' + notes[n].chapter +'"><h4 class="panel-title">';
						accordian = accordian + '<a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapse';
						accordian = accordian + notes[n].chapter + '" aria-expanded="false" aria-controls="collapse' + notes[n].chapter +'">';
						accordian = accordian + 'Chapter ' + notes[n].chapter;
						accordian = accordian + '</a></h4></div>';
						accordian = accordian + '<div id="collapse' + notes[n].chapter + '" class="panel-collapse collapse" role="tabpanel" '; 
						accordian = accordian + 'aria-labelledby="heading' + notes[n].chapter + '"><div class="panel-body">';
						for (var i = 0; i < notes[n].summary.length; i++)
						{
							accordian = accordian + notes[n].summary[i] + '<hr>';
						}
						accordian = accordian + '</div></div>';
						
					}
					
					accordian = accordian + '</div></div></div>';
					
					$('#booknotes').append(accordian);
					
				});
				
				
	
			}
			
			//sets the book information and image
			
			function makeNotesPage(isbn10Selected)
			{
				var ws = new cloudmine.WebService({
					appid: "8ea6c7b96d674a96ac7a27e5860abca2",
					apikey: "bc16bed76fd6468c8eb9dc362d7c75c4"
				});
				var searchStr = '[isbn10 = /^' + isbn10Selected + '.*/]';
				
				//searches database for isbn10
				ws.search(searchStr).on('success', function(data, response) {
					
					$("div.notes").each(function() {
						$(this).fadeOut('slow').remove();
					});
					
					//goes through all books
					for (var id in data) 
					{
						var obj = data[id];
						var bookData = '<div class="notes" style="padding-top: 56px;"><img style="float: left;" src="' 
						+ obj.image + 
						'" height="175" width="125" />' + 
						' <span style="padding-left:40px;"><strong>' + obj.title +
						'</strong></span><br /><span style="padding-left: 40px;"><strong>' +  obj.author + 
						'</strong></span><br />' + 
						'<span style="padding-left: 40px;">' + obj.isbn10 + 
						'</span><br /><span style="padding-left: 40px;">' +
						obj.isbn13 + '</span></div>';
						
						$('#booknotes').append(bookData);
						
						displayNotes(obj.isbn10, obj.isbn13);
						
						$('#searchdiv').fadeOut("slow", function() {
							$('div.search').fadeOut("slow");
					        $('#booknotes').fadeIn('slow');
	    				});	
					}
				});
			}

            $(function() {
	         
	         // fades in different divs depending on button clicks
             $("#addbutton").click( function() {
					if ( $('#home').is(':visible') )
					{
						$("#featurestab").fadeOut("slow");
						$("#aboutustab").fadeOut("slow");
						$("#contactustab").fadeOut("slow");
						$( "#home" ).fadeOut( "slow", function() {
							
							$("#adddiv").fadeIn("slow");							
							
            				});
            			}
            			
            			else if ( $('#booknotes').is(':visible') )
	            		{
		            		$("#searchbox").val("");
		            		
	            			$( "#booknotes" ).fadeOut( "slow", function() {
	
	            				$("#adddiv").fadeIn("slow");							
	
	            				});
	            			}
            			
                   		
                });
                $("#homebutton").click( function()
				{
					if ( $('#adddiv').is(':visible') )
					{
						$("#adddiv").fadeOut( "slow", function() {
							$("#featurestab").fadeIn("slow");
							$("#aboutustab").fadeIn("slow");
							$("#contactustab").fadeIn("slow");
							
							$("#home").fadeIn("slow");
							
							
            				});
            			}
            			else if ( $('#searchdiv').is(':visible') )
					{
						$("#searchdiv").fadeOut( "slow", function() {
							$("#featurestab").fadeIn("slow");
							$("#aboutustab").fadeIn("slow");
							$("#contactustab").fadeIn("slow");
							
							$("#home").fadeIn("slow");
							$("#searchbox").val("");
							
            				});
            			}
            			else if ( $('#booknotes').is(':visible') )
					{
						
							$("#booknotes").fadeOut( "slow", function() {
								$("div.notes").remove();
								$("div.notesaccordian").remove();
								$("#searchdiv table").undelegate();
								$("#featurestab").fadeIn("slow");
								$("#aboutustab").fadeIn("slow");
								$("#contactustab").fadeIn("slow");
								$("#searchbox").val("");
								$('div.search').fadeIn("slow");
								$("#home").fadeIn("slow");
								
							
            					});
            			}
                   		
                 });
                 
                //on every letter change the search function is called
                $('#searchbox').on('input', function() {
	                $("#searchdiv table").undelegate();
					var searchboxValue = $("#searchbox").val();
					
					if ( $('#home').is(':visible') )
					{
						lastDivShown = "home";
					}
					if ( $('#adddiv').is(':visible') )
					{
						lastDivShown = "adddiv";
					}
					
					$("div.notes").empty();
					$("div.notesaccordian").empty();
					
					//formulates search
					if(searchboxValue != "")
					{
						var ws = new cloudmine.WebService({
							appid: "8ea6c7b96d674a96ac7a27e5860abca2",
							apikey: "bc16bed76fd6468c8eb9dc362d7c75c4"
						});
						var searchStr = '[isbn10 = /^' + searchboxValue + '.*/ or isbn13=/^' + searchboxValue + '.*/ or title = /^' + searchboxValue + '.*/i or author = /^' + searchboxValue +  '.*/i]';
				
						ws.search(searchStr).on('success', function(data, response) {
							$("tr").each(function() {
								$(this).fadeOut('slow').remove();
							});
							
							var row = 0;
							for (var id in data) 
							{
								var obj = data[id];
								if (row == 0)
								{
									var tableData = '<td style="text-align: left; padding-left: 20px; padding-bottom: 42px; padding-top: 84px;">' + 
									'<img style="float: left;" src="' + obj.image + '" height="175" width="125" />' + 
									' <span style="padding-left:40px;"><strong>' + obj.title +
									'</strong></span><br /><span style="padding-left: 40px;"><strong>' +  obj.author + '</strong></span><br />' + 
									'<span style="padding-left: 40px;">' + obj.isbn10 + '</span><br /><span style="padding-left: 40px;">' +
									obj.isbn13 + '</span></td>';
									row = row + 1;
								}
								else
								{
									var tableData = '<td style="text-align: left; padding-left: 20px; padding-top: 28px; padding-bottom: 42px;">' + 
									'<img style="float: left;" src="' + obj.image + '" height="175" width="125" />' + 
									' <span style="padding-left:40px;"><strong>' + obj.title +
									'</strong></span><br /><span style="padding-left: 40px;"><strong>' +  obj.author + '</strong></span><br />' + 
									'<span style="padding-left: 40px;">' + obj.isbn10 + '</span><br /><span style="padding-left: 40px;">' +
									obj.isbn13 + '</span></td>';
								}
								
								
								var tableRow = ["<tr id='" + obj.isbn10 + "'>", tableData, "</tr>" ].join("");
								
								
								$('#searchtable > tbody:last').append(tableRow);
								
								//var $new = $(TableRow);
								//$('#searchtable > tbody:last').append($new);
								//$new.show('slow');
							}
						});
						
						$("#searchdiv table").delegate('tr', 'click', function() {
							var isbn10Selected = $(this).attr('id');
							makeNotesPage(isbn10Selected);
						
						});
						
						if ( $('#home').is(':visible') )
						{
							$("#featurestab").fadeOut("slow");
							$("#aboutustab").fadeOut("slow");
							$("#contactustab").fadeOut("slow");
							$("#home").fadeOut( "slow", function() {
								$("#searchdiv").fadeIn("slow", function() {
								
									
								
	            				});
	            			});
	            		}
	            		else if ( $('#adddiv').is(':visible') )
						{
							$("#featurestab").fadeOut("slow");
							$("#aboutustab").fadeOut("slow");
							$("#contactustab").fadeOut("slow");
							$("#adddiv").fadeOut( "slow", function() {
								$("#searchdiv").fadeIn("slow", function() {
									
									/*
									$("#searchdiv table").delegate('tr', 'click', function() {
								        
								        var isbn10Selected = $(this).attr('id');
								        makeNotesPage(isbn10Selected);

							});*/
								
	            				});
								
	            			});
	            		}
					}
					
				}).trigger('input');
   
            });            
			//loads search
			$(window).load(function() {
				$('#searchbox').on('input', function() {
				    if(($(this).val() == ''))
				    {
				        if(lastDivShown == "adddiv")
						{
							$("#searchdiv").fadeOut( "slow", function() {
								$("#adddiv").fadeIn("slow");
	            			});
						}
						if(lastDivShown == "home")
						{
							$("#searchdiv").fadeOut( "slow", function() {
								$("#home").fadeIn("slow");
								$("#featurestab").fadeIn("slow");
								$("#aboutustab").fadeIn("slow");
								$("#contactustab").fadeIn("slow");
	            			});
						}
				    }        
				});
			});
			
			
            //makes search button colors change
            var change_button_color = function ()
            {
	            	document.getElementById("searchbutton").style.backgroundColor = "#2494DC";
	            	document.getElementById("searchbutton").style.color = "#FFFFFF";
	            	document.getElementById("searchbutton").style.borderLeftColor =  "#055D96";
            }
            
            var button_color_reset = function ()
            {
	            	document.getElementById("searchbutton").style.backgroundColor = "";
	            	document.getElementById("searchbutton").style.color = "";
	            	document.getElementById("searchbutton").style.borderColor =  "";
            }
            
            //sets header for Cloudmine call
            function setCloudmineHeader(xhr)
			{
			    xhr.setRequestHeader('X-CloudMine-ApiKey', "bc16bed76fd6468c8eb9dc362d7c75c4");
			    xhr.setRequestHeader('Content-Type', 'application/json');
			    
			}
			
			//gets book data from cloudmine
			function getBookData(isbn10, isbn13) 
			{
			    //Build up the URL for the request
			    var searchStr = '[isbn10 = /^' + isbn10 + '.*/ , isbn13 = /^' + isbn13 + '.*/]';
			    //Return the promise from making an XMLHttpRequest to the server
			    return $.ajax({
			        url: 'https://api.cloudmine.me/v1/app/8ea6c7b96d674a96ac7a27e5860abca2/search?q=' + searchStr,
			        beforeSend: setCloudmineHeader,
			        context: this,
			        type: 'GET',
			        success: function (json) { 
				        
			        },
			        error: function(errorThrown) {
			           	console.log('Error Thrown: ' + errorThrown);
			           	console.log(requestStr);
			        }
			    });
			}
            
            //formulates cloudmine json
            function toJSON(isbn10, isbn13, title, author, imageUrl, notes)
            {
				
				json = {
	            			"isbn10": isbn10,
	            			"isbn13": isbn13,
							"title": title,
							"author": author,
							"image": imageUrl, 
							"notes": notes
    					};
				
				return json;
				
            }
            
            //set account key for getting image via Bing Image Search
            var accountKey = '1/AnrtVy8V7ukH9y77HNBPvr9JNNzYWN5sH2RZ3wVFI';
			var accountKeyEncoded = base64_encode(":" + accountKey);
			jQuery.support.cors = true;
			
			function setHeader(xhr)
			{
			    xhr.setRequestHeader('Authorization', "Basic " + accountKeyEncoded);
			}
			
			//get xml for search and return the data
			function getImageUrl(isbn) 
			{
			    //Build up the URL for the request
			    var requestStr = 'https://api.datamarket.azure.com/Bing/Search/v1/Image?Query=%27' + isbn + '%27'
			    //Return the promise from making an XMLHttpRequest to the server
			    var imgUrl;
			    return $.ajax({
			        url: requestStr,
			        beforeSend: setHeader,
			        context: this,
			        type: 'GET',
			        success: function (xml) { 
				        
			        },
			        error: function(jqXHR, textStatus, errorThrown) {
			           	console.log('Error getting bing image search');
			           	console.log('jqXHR: ' + jqXHR);
			           	console.log('Text Status: ' + textStatus);
			           	console.log('Error Thrown: ' + errorThrown);
			           	console.log(requestStr);
			        }
			    });
			}
			
			//base 64 encode the api key
			function base64_encode(data) 
			{
			    var b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
			    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,
			        ac = 0,
			        enc = "",
			        tmp_arr = [];
			
			    if (!data) 
			    {
			        return data;
			    }
			
			    do { // pack three octets into four hexets
			        o1 = data.charCodeAt(i++);
			        o2 = data.charCodeAt(i++);
			        o3 = data.charCodeAt(i++);
			
			        bits = o1 << 16 | o2 << 8 | o3;
			
			        h1 = bits >> 18 & 0x3f;
			        h2 = bits >> 12 & 0x3f;
			        h3 = bits >> 6 & 0x3f;
			        h4 = bits & 0x3f;
			
			        // use hexets to index into b64, and append result to encoded string
			        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);
			    } while (i < data.length);
			
			    enc = tmp_arr.join('');
			
			    var r = data.length % 3;
			
			    return (r ? enc.slice(0, r - 3) : enc) + '==='.slice(r || 3);
			
			}
			
			/*
			 * Converts a isbn10 number into a isbn13.
			 * The isbn10 is a string of length 10 and must be a legal isbn10. No dashes.
			 */
			function ISBN10toISBN13(isbn10) 
			{
			     
			    var sum = 38 + 3 * (parseInt(isbn10[0]) + parseInt(isbn10[2]) + parseInt(isbn10[4]) + parseInt(isbn10[6]) 
			                + parseInt(isbn10[8])) + parseInt(isbn10[1]) + parseInt(isbn10[3]) + parseInt(isbn10[5]) + parseInt(isbn10[7]);
			     
			    var checkDig = (10 - (sum % 10)) % 10;
			     
			    return "978" + isbn10.substring(0, 9) + checkDig;
			}
			 
			/*
			 * Converts a isbn13 into an isbn10.
			 * The isbn13 is a string of length 13 and must be a legal isbn13. No dashes.
			 */
			function ISBN13toISBN10(isbn13) 
			{
			 
			    var start = isbn13.substring(3, 12);
			    var sum = 0;
			    var mul = 10;
			    var i;
			     
			    for(i = 0; i < 9; i++) 
			    {
			        sum = sum + (mul * parseInt(start[i]));
			        mul -= 1;
			    }
			     
			    var checkDig = 11 - (sum % 11);
			    if (checkDig == 10) 
			    {
			        checkDig = "X";
			    } 
			    else if (checkDig == 11) 
			    {
			        checkDig = "0";
			    }
			     
			    return start + checkDig;
			}
			
			function parseXML(result)
			{
				var txt = (new XMLSerializer()).serializeToString(result);
				if (window.DOMParser)
				{
					parser=new DOMParser();
					xmlDoc=parser.parseFromString(txt,"text/xml");
				}
				else // Internet Explorer
				{
					xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
					xmlDoc.async=false;
					xmlDoc.loadXML(txt); 
				}
				//.getElementsByTagName("d\\:MediaUrl")[0].nodeValue
				var imgUrl = "";
				try
				{
					var url = xmlDoc.documentElement.childNodes[5].childNodes[3].childNodes[0].childNodes[9].firstChild;
					imgUrl = url.textContent;
				}
				catch(err){}
				
				return imgUrl;

			}
			
			//displays error message for empty title box
			function displayEmptyTitle()
			{
				$("#invalidalert").fadeOut("fast");
				document.getElementById('invalidalert').innerHTML = '<button type="button" class="close" ' + 
				'data-dismiss="alert" arialabel="Close"><span aria-hidden="true">&times;</span></button>' + 
				'<strong>No Title Enetered</strong> Please give a title to the textbook you are adding';
				$("#invalidalert").fadeIn("slow").delay(6000).fadeOut("slow");
			}
			
			//displays error message for empty author box
			function displayEmptyAuthor()
			{
				$("#invalidalert").fadeOut("fast");
				document.getElementById('invalidalert').innerHTML = '<button type="button" class="close" ' + 
				'data-dismiss="alert" arialabel="Close"><span aria-hidden="true">&times;</span></button>' + 
				'<strong>No Author Enetered</strong> Please give an author to the textbook you are adding';
				$("#invalidalert").fadeIn("slow").delay(6000).fadeOut("slow");
			}
			
			//displays error message for empty isbn box
			function displayEmptyIsbn()
			{
				$("#invalidalert").fadeOut("fast");
				document.getElementById('invalidalert').innerHTML = '<button type="button" class="close" ' + 
				'data-dismiss="alert" arialabel="Close"><span aria-hidden="true">&times;</span></button>' + 
				'<strong>No ISBN Enetered</strong> Please give a valid ISBN to the textbook you are adding';
				$("#invalidalert").fadeIn("slow").delay(6000).fadeOut("slow");
			}
			
			//displays error message for empty chapter box
			function displayEmptyChapter()
			{
				$("#invalidalert").fadeOut("fast");
				document.getElementById('invalidalert').innerHTML = '<button type="button" class="close" ' + 
				'data-dismiss="alert" arialabel="Close"><span aria-hidden="true">&times;</span></button>' + 
				'<strong>No Chapter Enetered</strong> Please give a chapter number to the textbook you are adding';
				$("#invalidalert").fadeIn("slow").delay(6000).fadeOut("slow");
			}
			
			//displays error message for empty notes box
			function displayEmptyNotes()
			{
				$("#invalidalert").fadeOut("fast");
				document.getElementById('invalidalert').innerHTML = '<button type="button" class="close" ' + 
				'data-dismiss="alert" arialabel="Close"><span aria-hidden="true">&times;</span></button>' + 
				'<strong>No Notes Enetered</strong> Please enter the notes you took';
				$("#invalidalert").fadeIn("slow").delay(6000).fadeOut("slow");
			}
			
			
			//add all information to cloudmine
			function addToCloudmine(isbn10, isbn13, title, author, imgUrl, chapter, previousNotes, notes)
			{
				var ws = new cloudmine.WebService({
					appid: "8ea6c7b96d674a96ac7a27e5860abca2",
					apikey: "bc16bed76fd6468c8eb9dc362d7c75c4"
				});
				
				var previousNotesExist = false;
				for (var n in previousNotes)
				{
					if(previousNotes[n].chapter == chapter)
					{
						previousNotes[n].summary.push(notes)	
						previousNotesExist = true;	
					}
				}
				
				if(!(previousNotesExist))
				{
					var notesJson = {
						"chapter": chapter,
						"summary": [
							notes
						]
					}
					previousNotes.push(notesJson);
				}
				
				var json = toJSON(isbn10, isbn13, title, author, imgUrl, previousNotes);	
				
				ws.set(isbn13, json).on('success', function(data, response) {
						$("#successalert").fadeIn("slow").delay(2500).fadeOut("slow");
						$("#title").val("");
						$("#author").val("");
						$("#isbn").val("");
						$("#chapter").val("");
						$("#notes").val("");
						
				});
			}
			
			//goes back to search div
			function backToSearch()
			{
				$("div.notesaccordian").each(function() {
					$(this).fadeOut('slow').remove();
				});
				$("#booknotes").fadeOut( "slow", function() {
					$('div.search').fadeIn("slow");
					$("#searchdiv").fadeIn("slow");
	            });
			}
			
			var isValidIsbn = function(str) {
			
				var sum,
					weight,
					digit,
					check,
					i;
			
				str = str.replace(/[^0-9X]/gi, '');
			
				if (str.length != 10 && str.length != 13) {
					return false;
				}
			
				if (str.length == 13) {
					sum = 0;
					for (i = 0; i < 12; i++) {
						digit = parseInt(str[i]);
						if (i % 2 == 1) {
							sum += 3*digit;
						} else {
							sum += digit;
						}
					}
					check = (10 - (sum % 10)) % 10;
					return (check == str[str.length-1]);
				}
			
				if (str.length == 10) {
					weight = 10;
					sum = 0;
					for (i = 0; i < 9; i++) {
						digit = parseInt(str[i]);
						sum += weight*digit;
						weight--;
					}
					check = 11 - (sum % 11);
					if (check == 10) {
						check = 'X';
					}
					return (check == str[str.length-1].toUpperCase());
				}
			}
			
			function replaceAll(str, find, replace) {
			  var i = str.indexOf(find);
			  if (i > -1){
				str = str.replace(find, replace); 
				i = i + replace.length;
				var st2 = str.substring(i);
				if(st2.indexOf(find) > -1){
				  str = str.substring(0,i) + replaceAll(st2, find, replace);
				}       
			  }
			  return str;
			}

			//adds textbook and calls image url, checks inputs as well
            function addTextbook()
			{
				var title = document.getElementById('title').value;
				var author = document.getElementById('author').value;
				var isbn = document.getElementById('isbn').value;
				var chapter = document.getElementById('chapter').value;
				var notes = document.getElementById('notes').value;
				
				if(!(title))
				{
					displayEmptyTitle();
				}
				else if (!(author))
				{
					displayEmptyAuthor();
				}
				else if (!(isbn))
				{
					displayEmptyIsbn();
				}
				else if(!(chapter))
				{
					displayEmptyChapter();
				}
				else if(!(notes))
				{
					displayEmptyNotes();
				}
				else
				{
					
					isbn = replaceAll(isbn, " ", "");
					
					var checkIsbn = replaceAll(isbn, "-", "");
					
					if( (isbn == null) || !(isValidIsbn(checkIsbn)) || (isbn == ""))
					{
						$("#isbninvalidalert").fadeIn("slow").delay(6000).fadeOut("slow");
						return;
					}
					getImageUrl(isbn).done(function(result) {
						
						var imgUrl = parseXML(result);
											
						if(imgUrl == "")
						{
							var isbnNoDash = replaceAll(isbn, "-", "");
							if (isbnNoDash.length == 13)
							{
								var isbn10 = ISBN13toISBN10(isbnNoDash);
								getImageUrl(isbn10).done(function(result) {
									imgUrl = parseXML(result);
									getBookData(isbn10, isbn).done(function(result) {
										var previousNotes = [];
										if(isbn in result.success)
										{
											var obj = result.success[isbn];
											previousNotes = obj.notes;
											title = obj.title;
											author = obj.author;
											addToCloudmine(isbn10, isbn, title, author, imgUrl, chapter, previousNotes, notes);
										}
										else
										{	
											addToCloudmine(isbn10, isbn, title, author, imgUrl, chapter, previousNotes, notes);
										}
									});
									
								});
								
								
							}
							else if(isbnNoDash.length == 10)
							{
								var isbn13 = ISBN10toISBN13(isbnNoDash);
								var isbn13Dash = isbn13.slice(0, 3) + "-" + isbn13.slice(3);
								getImageUrl(isbn13).done(function(result) {
									imgUrl = parseXML(result);
									getBookData(isbn, isbn13Dash).done(function(result) {
										var previousNotes = [];	
										if(isbn13Dash in result.success)
										{
											var obj = result.success[isbn13Dash];
											previousNotes = obj.notes;
											title = obj.title;
											author = obj.author;
											addToCloudmine(isbn, isbn13Dash, title, author, imgUrl, chapter, previousNotes, notes);
										}
										else
										{
											addToCloudmine(isbn, isbn13Dash, title, author, imgUrl, chapter, previousNotes, notes);
										}
											
									});
								});
							}
						}
						else
						{
							var isbnNoDash = replaceAll(isbn, "-", "");
							if (isbnNoDash.length == 13)
							{
								
								var isbn10 = ISBN13toISBN10(isbnNoDash);
								getBookData(isbn10, isbn).done(function(result) {
										var previousNotes = [];
										if(isbn in result.success)
										{
											var obj = result.success[isbn];
											previousNotes = obj.notes;
											title = obj.title;
											author = obj.author;
											addToCloudmine(isbn10, isbn, title, author, imgUrl, chapter, previousNotes, notes);
										}
										else
										{
											addToCloudmine(isbn10, isbn, title, author, imgUrl, chapter, previousNotes, notes);
										}
										
								});
								
							}
							else if(isbnNoDash.length == 10)
							{
								var isbn13 = ISBN10toISBN13(isbnNoDash);
								var isbn13Dash = isbn13.slice(0, 3) + "-" + isbn13.slice(3);
								
								getBookData(isbn, isbn13Dash).done(function(result) {
										var previousNotes = [];
										if(isbn13Dash in result.success)
										{
											var obj = result.success[isbn13Dash];
											previousNotes = obj.notes;
											title = obj.title;
											author = obj.author;
											addToCloudmine(isbn, isbn13Dash, title, author, imgUrl, chapter, previousNotes, notes);
										}
										else
										{
											addToCloudmine(isbn, isbn13Dash, title, author, imgUrl, chapter, previousNotes, notes);
										}
										
										
								});
							}
						}
					});
				}
			}
            
        </script>
        <style type="text/css">
	        html
	        {
		        overflow-y: scroll;
	        }
            .thumbnail.blue
            {
	            	padding: 58px;
	            	background: #48a7e6;
	            	color: #FFFFFF;
	           		text-align: center;
            }
            
            .thumbnail.white
            {
            		text-align: center;
            }
            
            .caption.blue
            {
            	color: #FFFFFF;
            }
            
            .thumbnail.noborder 
            {
            	border: 0 none;
				box-shadow: none;
            }
            
            html, body 
            {
           		max-width: 100%;
            	overflow-x: hidden;
            }
            
            div.center
            {
            	text-align: center;
            }
            
            div.text
            {
            	font-size: 24px;
				color: #FFFFFF;
				text-align: center;
				margin-top: 20px;
				margin-left: 5px;
            	display: flex;
				justify-content: center; /* align horizontal */
            	align-items: center; /* align vertical */
				padding: 20px;
            }
            
            div.boxblue
            {
            	background: #48a7e6;
				height: 300px;
				width: auto;
            }
            
            div.boxbluesmall
            {
            	background: #48a7e6;
				height: 400px;
				width: auto;
				color: #ffffff;
				text-align: center;
            }
            
            div.boxwhite
            {
            	background: #FFFFFF;
				height: 450px;
				width: auto;
            }
            
            div.image
            {
            	color: #FFFFFF;
				padding-top: 65px;
				text-align: center;
            }
            
            .panel 
            {
				border: 0;
				box-shadow: 0px 0px 0px black;
				box-shadow: inset 0px 0px 0px black;
			}
			
			.alert
			{
				position: absolute;
				width: 400px;
			    left: 0;
			    right: 0;
			    margin-left: auto;
			    margin-right: auto;
			    padding: 8px 35px 8px 14px;
				
			}
			a.contact
			{
				color: #FFFFFF;
			}
			
			a.contact:hover
			{
				color: #595959;
			}
			
			.table-no-border>thead>tr>th, 
			.table-no-border>tbody>tr>th, 
			.table-no-border>tfoot>tr>th, 
			.table-no-border>thead>tr>td, 
			.table-no-border>tbody>tr>td, 
			.table-no-border>tfoot>tr>td 
			{
			  border-top: none; 
			  border-bottom: 1px solid #ddd;
			}
			
			.table-no-border tr 
			{
			  -o-transition:color .2s ease-out, background 1s ease-in;
			  -ms-transition:color .2s ease-out, background 1s ease-in;
			  -moz-transition:color .2s ease-out, background 1s ease-in;
			  -webkit-transition:color .2s ease-out, background 1s ease-in;
			  /* ...and now override with proper CSS property */
			  transition:color .2s ease-out, background 1s ease-in;
			}
			
			.table-no-border tr:hover
			{
				background-color: #D3D3D3;
			}
        </style>
    </head>
    <body>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js" type="text/javascript"></script><!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="js/bootstrap.min.js" type="text/javascript"></script>
        <a name="features"></a> 
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"><span class="sr-only">Toggle navigation</span></button> <a class="navbar-brand hvr-pop" id="homebutton" href="#features">TextNotes</a>
                    </div>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li><a id="featurestab" class="hvr-bob" href="#features">Features</a></li>
                            <li><a id="aboutustab" class="hvr-bob" href="#aboutus">About Us</a></li>
                            <li><a id="contactustab" class="hvr-bob" href="#contactus">Contact Us </a></li>
                        </ul>
						<div class="search" style="margin: 0px auto; text-align:center; max-width: 250px;">
						    <form class="navbar-form navbar-left" style="width:100%;" role="search" id="searchform">
                                <div class="form-group" id="the-basics">
                                    <input type="text" id="searchbox" class="form-control typeahead" placeholder="Search TextNotes" style="border-top-right-radius: 0px; border-bottom-right-radius: 0px;" onfocus="change_button_color()" onblur="button_color_reset()">
                                </div>
                                <button id="searchbutton" type="submit" class="btn btn-default" style="margin-left:-4px; border-top-left-radius: 0px; border-bottom-left-radius:0px;"><span class="glyphicon glyphicon-search"></span></button>
                            </form>
                        </div>
                        <ul class="nav navbar-nav navbar-right">
                            <button id="addbutton" type="button" class="btn btn-default navbar-btn"><i class="fa fa-plus"></i></button>
                        </ul>
                    </div>
                    <!-- /.navbar-collapse -->
                </div>
                <!-- /.container-fluid -->
            </div>
        </nav>
        <div id="home">
            <div class="row center" style="padding-bottom: 28px; padding-top: 84px; padding-right: 28px; padding-left: 28px;">
                <div class="col-sm-4">
                    <div class="thumbnail noborder">
                        <i class="fa fa-users fa-5x"></i>
                        <div class="caption">
                            <h3>Community Driven</h3>
                            <p>The more notes are added, the more knowledge is shared.</p>
                        </div>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="thumbnail noborder">
                        <i class="fa fa-search fa-5x"></i>
                        <div class="caption">
                            <h3>Search Notes</h3>
                            <p>Find notes from other students who have read the textbook.</p>
                        </div>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="thumbnail noborder">
                        <i class="fa fa-plus fa-5x"></i>
                        <div class="caption">
                            <h3>Add Notes</h3>
                            <p>The more notes are added, the more knowledge is shared.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="boxblue">
                <div class="col-md-12">
                    <div class="thumbnail noborder blue">
                        <img src="images/text-notes-icon.png" height="80" width="80">
                        <div class="caption blue">
                            <h3>TextNotes</h3>
                            <p>Note now, review later.</p>
                        </div>
                    </div>
                </div>
            </div>
            <a name="aboutus" style="padding: 72px;"></a> 
            <div class="boxwhite">
                <div class="col-md-12">
                    <div class="thumbnail noborder white">
                        <h3 style="padding-bottom:20px;">About Us</h3>
                        <img src="images/trevor-heins.JPG"class="img-rounded" width="150px" height="100px">
                        <div class="caption">
                            <h4>Trevor Heins</h4>
                            <p style="padding-left:200px; padding-right:200px;">Trevor Heins is a Software Engineering student at Drexel University. His passion is making powerful apps that are simple to use.</p>
                        </div>
                    </div>
                </div>
            </div>
            <a name="contactus"></a> 
            <div class="boxbluesmall">
	            <h3 style="padding-top:60px">Contact Us</h3>
				<h4>Click on the icons below to get in touch!</h4>
	            <div class="row center" style="padding:28px;">
                <div class="col-sm-4">
                    <div class="thumbnail noborder blue">
                        <a href="mailto:heinstrevorj@gmail.com" class="contact"><i class="fa fa-envelope-o fa-5x"></i></a>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="thumbnail noborder blue">
                    	<a href="https://www.facebook.com/TextNotesApp" class="contact"><i class="fa fa-facebook fa-5x"></i></a>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="thumbnail noborder blue">
                        <a href="https://twitter.com/textnotesapp" class="contact"><i class="fa fa-twitter fa-5x"></i></a>
                    </div>
                </div>
            </div>

            </div>
        </div>
		<div id="adddiv" style="display:none; text-align:center; padding-bottom: 28px; padding-top: 56px; padding-right: 28px; padding-left: 28px;">
			<div class="alert alert-success alert-dismissible" role="alert" id="successalert" style="display: none;text-align:center;">
				<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<strong>Success!</strong> Your notes were successfully added!
			</div>
			<div class="alert alert-danger alert-dismissible" role="alert" id="isbninvalidalert" style="display: none;text-align:center;">
				<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<strong>Invalid ISBN</strong> The ISBN you entered was invalid. Please enter a new ISBN
			</div>
			<div class="alert alert-danger alert-dismissible" role="alert" id="invalidalert" style="display: none;text-align:center;">
				
			</div>
	        <div class="col-xs-offset-4 col-md-4" style="padding-top: 60px;">
	            <h4>Add Notes for a Textbook:</h4>
	            <div class="panel panel-default">
	                <div class="panel-body form-horizontal">
	                    <div class="form-group">
	                        <label for="concept" class="col-sm-3 control-label">Title</label>
	                        <div class="col-sm-9">
	                            <input type="text" class="form-control" id="title" name="concept">
	                        </div>
	                    </div>
	                    <div class="form-group">
	                        <label for="description" class="col-sm-3 control-label">Author</label>
	                        <div class="col-sm-9">
	                            <input type="text" class="form-control" id="author" name="description">
	                        </div>
	                    </div> 
	                    <div class="form-group">
	                        <label for="amount" class="col-sm-3 control-label">ISBN</label>
	                        <div class="col-sm-9">
	                            <input type="text" class="form-control" id="isbn" name="description">
	                        </div>
	                    </div>
	                    <div class="form-group">
	                        <label for="amount" class="col-sm-3 control-label">Chapter</label>
	                        <div class="col-sm-9">
	                            <input type="text" class="form-control" id="chapter" name="description">
	                        </div>
	                    </div>
	                    <div class="form-group">
	                        <label for="date" class="col-sm-3 control-label">Notes</label>
	                        <div class="col-sm-9">
	                            <textarea class="form-control" rows="10" id="notes"></textarea>
	                        </div>
	                    </div> 
	                    <div class="form-group">
	                        <div class="col-sm-12 text-right">
	                            <button type="button" class="btn btn-success" onclick="addTextbook()">
	                                <span class="glyphicon glyphicon-ok"></span> Add
	                            </button>
	                        </div>	                        
	                    </div>
	                </div>
	            </div>            
	        </div>
		</div>
		<div id="searchdiv" style="display:none;">
			<table class="table table-no-border" id="searchtable">
				<tbody>
					
				</tbody>
			</table>
		</div>
		<div id="booknotes" style="display:none; padding-top: 84px; padding-left: 20px;">
			<button class="btn btn-link btn-lg" onclick="backToSearch()" style="float: left;"><span class="glyphicon glyphicon-chevron-left"></span>Back</button>
			
		</div>
    </body>
</html>